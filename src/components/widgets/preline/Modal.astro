<div
  id="contact-modal"
  class="hs-overlay hidden fixed inset-0 z-50 overflow-y-auto pointer-events-none"
  role="dialog"
  aria-modal="true"
  tabindex="-1"
  aria-labelledby="contact-modal-label"
  aria-describedby="contact-modal-desc"
>
  <div
    class="hs-overlay-open:mt-3 md:hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500
           mt-0 opacity-0 ease-out transition-all sm:max-w-lg sm:w-full m-3 sm:mx-auto pointer-events-auto"
  >
    <!-- Card -->
    <div class="relative flex flex-col border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 bg-white shadow-xl">
      <div class="mb-8">
        <h2 id="contact-modal-label" class="mb-1 font-heading text-2xl font-semibold text-gray-800">
          Get Your Clean Books Plan
        </h2>
        <p id="contact-modal-desc" class="text-sm text-gray-500">No spam. We‚Äôll call you within 1 business day.</p>
      </div>
      <div class="absolute top-2 end-2">
        <button
          type="button"
          class="size-8 inline-flex items-center justify-center rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200 focus:outline-hidden"
          aria-label="Close"
          data-hs-overlay="#contact-modal"
        >
          <span class="sr-only">Close</span>
          <svg
            class="size-4"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18"></path><path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
      <form
        id="contact-form"
        name="clean-books-plan"
        method="POST"
        data-netlify="true"
        netlify-honeypot="bot-field"
        novalidate
      >
        <input type="hidden" name="form-name" value="clean-books-plan" />
        <p class="hidden">
          <label
            >Don‚Äôt fill this out if you‚Äôre human:
            <input name="bot-field" />
          </label>
        </p>
        <div class="grid gap-4">
          <!-- Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="hs-firstname-contacts-1" class="sr-only">First Name</label>
              <input
                id="hs-firstname-contacts-1"
                name="firstName"
                autocomplete="given-name"
                type="text"
                class="py-2.5 sm:py-3 px-4 block w-full border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none"
                placeholder="First name"
                required
                aria-required="true"
              />
            </div>

            <div>
              <label for="hs-lastname-contacts-1" class="sr-only">Last Name</label>
              <input
                id="hs-lastname-contacts-1"
                name="lastName"
                autocomplete="family-name"
                type="text"
                class="py-2.5 sm:py-3 px-4 block w-full border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none"
                placeholder="Last name"
                required
                aria-required="true"
              />
            </div>
          </div>
          <!-- End Grid -->

          <div>
            <label for="hs-email-contacts-1" class="sr-only">Email</label>
            <input
              id="hs-email-contacts-1"
              name="email"
              type="email"
              autocomplete="email"
              class="py-2.5 sm:py-3 px-4 block w-full border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none"
              placeholder="you@business.com"
              required
              aria-required="true"
            />
          </div>

          <div>
            <label for="hs-phone-number-1" class="sr-only">Phone Number</label>
            <input
              id="hs-phone-number-1"
              name="phone"
              type="tel"
              inputmode="tel"
              autocomplete="tel"
              pattern="[\s\-().+\d]{7,}"
              title="Use digits only or any common phone format"
              class="py-2.5 sm:py-3 px-4 block w-full border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none"
              placeholder="412-555-1234"
              required
              aria-required="true"
            />
          </div>

          <div>
            <label for="hs-about-contacts-1" class="sr-only">Details</label>
            <textarea
              id="hs-about-contacts-1"
              name="details"
              rows="4"
              class="py-2.5 sm:py-3 px-4 block w-full border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none"
              placeholder="Details (optional)"></textarea>
          </div>
        </div>
        <!-- End Grid -->

        <div class="mt-4 grid">
          <button
            id="contact-submit"
            type="submit"
            class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-xl border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-hidden focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
            >Send</button
          >
        </div>

        <div>
          <p class="mt-3 text-center text-sm text-gray-500">
            üîí 100% private and secure.
            <br />
            ‚ö°Ô∏è Lightning-fast reply.
          </p>
        </div>
      </form>
    </div>
    <!-- End Card -->
  </div>
</div>

<script>
  (() => {
    // Form + controls (IDs match your markup exactly)
    const form = document.getElementById('contact-form');
    const submit = document.getElementById('contact-submit');

    const first = document.getElementById('hs-firstname-contacts-1');
    const last = document.getElementById('hs-lastname-contacts-1');
    const email = document.getElementById('hs-email-contacts-1');
    const phone = document.getElementById('hs-phone-number-1');
    const details = document.getElementById('hs-about-contacts-1'); // optional

    // Helpers
    const normalizePhone = (v) => (v || '').replace(/[^\d]/g, '');

    function setError(input, message = '') {
      let msg = input.nextElementSibling;
      if (!msg || !msg.classList.contains('rb-error')) {
        msg = document.createElement('p');
        msg.className = 'rb-error mt-1 text-xs text-red-600';
        input.insertAdjacentElement('afterend', msg);
      }
      if (message) {
        input.setAttribute('aria-invalid', 'true');
        msg.textContent = message;
        msg.style.display = 'block';
      } else {
        input.removeAttribute('aria-invalid');
        msg.textContent = '';
        msg.style.display = 'none';
      }
    }

    function validateField(input) {
      // Required fields
      if ([first, last, email, phone].includes(input) && !input.value.trim()) {
        setError(input, 'This field is required.');
        return false;
      }

      if (input === email) {
        const ok = /\S+@\S+\.\S+/.test(email.value);
        if (!ok) {
          setError(email, 'Enter a valid email.');
          return false;
        }
      }

      if (input === phone) {
        const digits = normalizePhone(phone.value);
        if (digits.length < 10) {
          setError(phone, 'Enter a valid phone number.');
          return false;
        }
      }

      setError(input, '');
      return true;
    }

    // Inline validation on blur for quick feedback
    [first, last, email, phone].forEach((el) => {
      el.addEventListener('blur', () => validateField(el));
    });

    // Submit handler: block if invalid, otherwise allow Netlify to submit
    form.addEventListener('submit', (e) => {
      const ok = validateField(first) && validateField(last) && validateField(email) && validateField(phone);

      if (!ok) {
        e.preventDefault();
        const firstBad = form.querySelector('[aria-invalid="true"]');
        if (firstBad) firstBad.focus();
        return;
      }

      // Valid ‚Äî do NOT preventDefault; Netlify captures the POST.
      // Optionally add a lightweight UI lock to prevent double-submits:
      submit.disabled = true;
      form.setAttribute('aria-busy', 'true');
    });
  })();
</script>
