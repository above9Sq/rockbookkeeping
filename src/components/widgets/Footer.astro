---
import { Icon } from 'astro-icon/components';
import { SITE } from 'astrowind:config';
import { getHomePermalink } from '~/utils/permalinks';

interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

interface LinksGroup {
  title?: string;
  links: Array<Link>;
}

export interface Props {
  links: Array<LinksGroup>; // keep original grouped shape
  secondaryLinks: Array<Link>;
  socialLinks: Array<Link>;
  footNote?: string;
  theme?: string;
}

const { socialLinks = [], secondaryLinks = [], links = [], footNote = '', theme = 'light' } = Astro.props;

// flatten all groups into a single list
const flatLinks: Array<Link> = (links || []).flatMap((g) => g?.links || []).filter(Boolean);
---

<footer class="relative border-t border-gray-700 bg-gray-800 text-white not-prose">
  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 py-8 md:py-12 flex flex-col items-center text-center gap-4">
    <!-- Logo -->
    <div>
      <a class="inline-block font-bold text-xl text-white" href={getHomePermalink()}>{SITE?.name}</a>
    </div>

    <!-- Main Links -->
    {
      flatLinks.length > 0 && (
        <ul class="flex flex-col gap-3 text-base font-medium sm:flex-row sm:flex-wrap sm:justify-center sm:gap-6">
          {flatLinks.map(({ text, href, ariaLabel }) => (
            <li>
              <a
                class="text-white hover:text-gray-300 transition duration-150 ease-in-out"
                href={href}
                aria-label={ariaLabel}
              >
                <Fragment set:html={text} />
              </a>
            </li>
          ))}
        </ul>
      )
    }

    <!-- Legal Links -->
    {
      secondaryLinks?.length > 0 && (
        <div class="text-xs flex flex-wrap justify-center gap-2 mt-4">
          {secondaryLinks.map(({ text, href }) => (
            <a class="text-white hover:text-gray-300 transition duration-150 ease-in-out" href={href} set:html={text} />
          ))}
        </div>
      )
    }

    <!-- Copyright -->
    {
      footNote && (
        <div class="text-xs mt-2 text-white">
          <Fragment set:html={footNote} />
        </div>
      )
    }
  </div>
</footer>
