---
import SmsIcon from '/src/assets/images/sms.svg';
import { headerData } from '~/navigation';
import { btnSolidDarkShell } from '~/styles/buttonStyles';

const { phoneNumber } = headerData;
const smsHref = `sms:${phoneNumber.replace(/[^0-9]/g, '')}`;
---

<!-- Mobile-only bottom sticky text CTA -->
<div
  id="mobile-phone-cta"
  class="fixed inset-x-0 bottom-0 z-[75] lg:hidden bg-white shadow-[0_-2px_4px_rgba(0,0,0,0.05)] px-4 pt-4
         pointer-events-none opacity-0 translate-y-full transition-all duration-200 ease-out"
  style="padding-bottom: calc(env(safe-area-inset-bottom) + 1rem);"
  aria-hidden="true"
>
  <a
    href={smsHref}
    aria-label={`Text Rock Bookkeeping at ${phoneNumber}`}
    class={`${btnSolidDarkShell} pointer-events-auto w-full px-6 text-lg gap-x-3 shadow-md`}
  >
    <SmsIcon class="w-5 h-5 shrink-0" />
    <span>Text Josh: {phoneNumber}</span>
  </a>
</div>

<script is:inline>
  const runMobilePhoneCTA = () => {
    // Only care about mobile
    if (window.innerWidth >= 1024) return;

    const hero = document.querySelector('[data-hero]');
    const wrapper = document.getElementById('mobile-phone-cta');

    if (!hero || !wrapper) return;

    const show = () => {
      wrapper.classList.remove('opacity-0', 'translate-y-full', 'pointer-events-none');
      wrapper.classList.add('opacity-100', 'translate-y-0');
      wrapper.setAttribute('aria-hidden', 'false');
    };

    const hide = () => {
      wrapper.classList.add('opacity-0', 'translate-y-full', 'pointer-events-none');
      wrapper.classList.remove('opacity-100', 'translate-y-0');
      wrapper.setAttribute('aria-hidden', 'true');
    };

    // Start hidden while hero is in view
    hide();

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          hide();
        } else {
          show();
        }
      },
      { threshold: 0.1 }
    );

    observer.observe(hero);
  };

  document.addEventListener('DOMContentLoaded', runMobilePhoneCTA);
  window.addEventListener('astro:page-load', runMobilePhoneCTA);
  window.addEventListener('resize', runMobilePhoneCTA);
</script>
