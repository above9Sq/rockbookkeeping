---
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';
import PostTags from '~/components/blog/Tags.astro';
import SocialShare from '~/components/common/SocialShare.astro';
import CtaButton from '~/components/widgets/CtaButton.astro';

import { getPermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';

import type { Post } from '~/types';

export interface Props {
  post: Post;
  url: string | URL;
}

const { post, url } = Astro.props;

const date = getFormattedDate(post.publishDate);
const author = post.author;
const category = post.category?.title;
const readingTime = post.readingTime ? `${post.readingTime} min read` : null;
---

<section class="py-0 lg:py-12">
  <div class="mx-auto max-w-3xl px-0 sm:px-6">
    <article class="flex flex-col gap-8 md:gap-16">
      <!-- Main Content Card -->
      <div class="bg-white p-8 lg:p-10 rounded-lg">
        <!-- Title -->
        <h1 class="text-3xl lg:text-4xl font-black text-gray-900 mb-4 leading-tight">
          {post.title}
        </h1>

        <!-- Excerpt -->
        <p class="text-gray-900 text-lg leading-relaxed font-medium mb-6">
          {post.excerpt}
        </p>

        <!-- Metadata Byline -->
        <div
          class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-700 mb-6 pb-5 border-b border-gray-300"
        >
          <time datetime={String(post.publishDate)} class="flex items-center font-medium">
            <Icon name="tabler:calendar" class="w-4 h-4 mr-1.5 text-gray-600" />
            {date}
          </time>
          {
            author && (
              <span class="flex items-center font-medium">
                <Icon name="tabler:user" class="w-4 h-4 mr-1.5 text-gray-600" />
                {author}
              </span>
            )
          }
          {
            category && (
              <a
                href={getPermalink(post.category.slug, 'category')}
                class="flex items-center font-medium hover:underline"
              >
                <Icon name="tabler:folder" class="w-4 h-4 mr-1.5 text-gray-600" />
                {category}
              </a>
            )
          }
          {
            readingTime && (
              <span class="flex items-center font-medium">
                <Icon name="tabler:clock" class="w-4 h-4 mr-1.5 text-gray-600" />
                {readingTime}
              </span>
            )
          }
        </div>

        <!-- Featured Image -->
        {
          post.image ?
            <Image
              src={post.image}
              class="w-full h-auto rounded-md object-cover shadow-md mb-8"
              widths={[400, 768]}
              sizes="(max-width: 768px) 100vw, 768px"
              alt={post?.excerpt || post.title}
              width={768}
              height={432}
              loading="eager"
              decoding="async"
            />
          : <div class="h-px bg-gray-300 my-8" />
        }

        <!-- Post Body â€“ Asymmetric H2 Spacing -->
        <div
          class="prose prose-lg max-w-none mt-8
                    text-gray-900
                    prose-headings:font-black prose-headings:text-gray-900 prose-headings:tracking-tight prose-headings:leading-tight
                    prose-h2:mt-3 prose-h2:mb-5
                    prose-h3:mt-3 prose-h3:mb-4
                    prose-h4:mt-2 prose-h4:mb-3
                    prose-p:leading-relaxed prose-p:text-gray-800
                    prose-a:text-blue-600 prose-a:font-medium prose-a:underline hover:prose-a:text-blue-800
                    prose-strong:font-bold prose-strong:text-gray-900
                    prose-blockquote:border-l-4 prose-blockquote:border-blue-600 prose-blockquote:pl-5 prose-blockquote:italic prose-blockquote:text-gray-700
                    prose-ul:my-4 prose-li:my-1 prose-li:text-gray-800
                    prose-img:rounded-md prose-img:shadow-md prose-img:my-10
                    prose-hr:border-gray-300"
        >
          <slot />
        </div>

        <!-- Tags + Social Share -->
        <div
          class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-12 pt-8 border-t border-gray-300 gap-6"
        >
          <PostTags tags={post.tags} class="text-sm font-medium text-gray-700" />
          <SocialShare url={url} text={post.title} class="text-sm text-gray-600" />
        </div>
      </div>

      <!-- CTA Button -->
      <div class="text-center mt-10">
        <CtaButton text="Fix My Books Now" />
      </div>
    </article>
  </div>
</section>
